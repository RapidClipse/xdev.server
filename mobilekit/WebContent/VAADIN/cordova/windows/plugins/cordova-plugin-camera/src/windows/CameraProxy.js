cordova.define("cordova-plugin-camera.CameraProxy",function(e,t,n){function i(e,t,n,i,o,r){var a="";a=r==p.EncodingType.PNG?"camera_cordova_temp_return.png":"camera_cordova_temp_return.jpg";var c=g().localFolder;n.copyAsync(c,n.name,Windows.Storage.NameCollisionOption.replaceExisting).then(function(e){return w.readBufferAsync(e)}).then(function(r){var c=f(r),d="data:"+n.contentType+";base64,"+c,s=new Image;s.src=d,s.onload=function(){var r,c=Math.min(i/this.width,o/this.height),d=c*this.width,s=c*this.height,l=document.createElement("canvas");l.width=d,l.height=s,l.getContext("2d").drawImage(this,0,0,d,s);var u=l.toDataURL(n.contentType).split(",")[1],p=g().localFolder;p.createFileAsync(a,h).then(function(e){var t=Windows.Security.Cryptography.CryptographicBuffer.decodeFromBase64String(u);return r=e.name,w.writeBufferAsync(e,t)}).done(function(){e("ms-appdata:///local/"+r)},t)}}).done(null,function(e){t(e)})}function o(e,t,n,i,o){w.readBufferAsync(n).done(function(t){var r=f(t),a="data:"+n.contentType+";base64,"+r,c=new Image;c.src=a,c.onload=function(){var t=Math.min(i/this.width,o/this.height),r=t*this.width,a=t*this.height,c=document.createElement("canvas");c.width=r,c.height=a;var d=c.getContext("2d");d.drawImage(this,0,0,r,a);var s=c.toDataURL(n.contentType),l=s.split(","),u=s.substr(l[0].length+1);e(u)}},function(e){t(e)})}function r(e,t,n){0>navigator.appVersion.indexOf("Windows Phone 8.1")?c(e,t,n):a(e,t,n)}function a(e,t,n){var r=n[6],a=n[1],c=n[3],d=n[4],s=n[5],l=function(n){if(n.kind===Windows.ApplicationModel.Activation.ActivationKind.pickFileContinuation){var r=n.files[0];if(!r)return t("User didn't choose a file."),m.removeEventListener("activated",l),void 0;if(a==p.DestinationType.FILE_URI||a==p.DestinationType.NATIVE_URI)if(d>0&&c>0)i(e,t,r,c,d,s);else{var u=g().localFolder;r.copyAsync(u,r.name,Windows.Storage.NameCollisionOption.replaceExisting).done(function(t){a==p.DestinationType.NATIVE_URI?e("ms-appdata:///local/"+t.name):e(URL.createObjectURL(t))},function(){t("Can't access localStorage folder.")})}else d>0&&c>0?o(e,t,r,c,d):w.readBufferAsync(r).done(function(t){var n=f(t);e(n)},t);m.removeEventListener("activated",l)}},u=new Windows.Storage.Pickers.FileOpenPicker;r==p.MediaType.PICTURE?(u.fileTypeFilter.replaceAll([".png",".jpg",".jpeg"]),u.suggestedStartLocation=y.picturesLibrary):r==p.MediaType.VIDEO?(u.fileTypeFilter.replaceAll(C),u.suggestedStartLocation=y.videosLibrary):(u.fileTypeFilter.replaceAll(["*"]),u.suggestedStartLocation=y.documentsLibrary),m.addEventListener("activated",l),u.pickSingleFileAndContinue()}function c(e,t,n){var r=n[6],a=n[1],c=n[3],d=n[4],s=n[5],l=new Windows.Storage.Pickers.FileOpenPicker;r==p.MediaType.PICTURE?(l.fileTypeFilter.replaceAll([".png",".jpg",".jpeg"]),l.suggestedStartLocation=y.picturesLibrary):r==p.MediaType.VIDEO?(l.fileTypeFilter.replaceAll(A),l.suggestedStartLocation=y.videosLibrary):(l.fileTypeFilter.replaceAll(["*"]),l.suggestedStartLocation=y.documentsLibrary),l.pickSingleFileAsync().done(function(n){if(!n)return t("User didn't choose a file."),void 0;if(a==p.DestinationType.FILE_URI||a==p.DestinationType.NATIVE_URI)if(d>0&&c>0)i(e,t,n,c,d,s);else{var r=g().localFolder;n.copyAsync(r,n.name,Windows.Storage.NameCollisionOption.replaceExisting).done(function(t){a==p.DestinationType.NATIVE_URI?e("ms-appdata:///local/"+t.name):e(URL.createObjectURL(t))},function(){t("Can't access localStorage folder.")})}else d>0&&c>0?o(e,t,n,c,d):w.readBufferAsync(n).done(function(t){var n=f(t);e(n)},t)},function(){t("User didn't choose a file.")})}function d(e,t,n){Windows.Media.Capture.CameraCaptureUI?l(e,t,n):s(e,t,n)}function s(e,t,n){function i(){var e="width:45%;padding: 10px 16px;font-size: 18px;line-height: 1.3333333;color: #333;background-color: #fff;border-color: #ccc; border: 1px solid transparent;border-radius: 6px; display: block; margin: 20px; z-index: 1000;border-color: #adadad;";F=document.createElement("video"),F.style.cssText="position: fixed; left: 0; top: 0; width: 100%; height: 100%; z-index: "+(T-1)+";",x=document.createElement("button"),x.innerText="Take",x.style.cssText=e+"position: fixed; left: 0; bottom: 0; margin: 20px; z-index: "+T+";",L=document.createElement("button"),L.innerText="Cancel",L.style.cssText=e+"position: fixed; right: 0; bottom: 0; margin: 20px; z-index: "+T+";",M=new k.MediaCapture,I=new k.MediaCaptureInitializationSettings,I.streamingCaptureMode=k.StreamingCaptureMode.video}function o(){F&&F.play()}function r(){var e=Windows.Devices.Enumeration,n=E===1?e.Panel.front:e.Panel.back;window.addEventListener("focus",o),e.DeviceInformation.findAllAsync(e.DeviceClass.videoCapture).then(function(e){return e.length>0?(e.forEach(function(e){e.enclosureLocation.panel&&e.enclosureLocation.panel==n&&(I.videoDeviceId=e.id)}),I.photoCaptureSource=Windows.Media.Capture.PhotoCaptureSource.photo,M.initializeAsync(I)):(a(),t("Camera not found"),void 0)}).then(function(){var e=M.videoDeviceController,n=e.focusControl;n.supported===!0&&F.addEventListener("click",function(){if(this.getAttribute("clicked")==="1")return!1;this.setAttribute("clicked","1");var e=Windows.Media.Devices.FocusPreset.autoNormal,t=this;n.setPresetAsync(e).done(function(){t.setAttribute("clicked","0")})}),F.msZoom=!0,F.src=URL.createObjectURL(M),F.play(),D=Windows.Devices.Sensors.SimpleOrientationSensor.getDefault(),D!==null&&D.addEventListener("orientationchanged",m),x.addEventListener("click",l),L.addEventListener("click",f),D?y(D.getCurrentOrientation()):y(Windows.Graphics.Display.DisplayInformation.getForCurrentView().currentOrientation);var i=d(M);return i.length===0?(a(),t("There's not a good aspect ratio available"),void 0):(document.body.appendChild(F),document.body.appendChild(x),document.body.appendChild(L),i.indexOf(S)>-1?s(M,S):s(M,i[0]))}).done(null,function(e){a(),t("Camera intitialization error "+e)})}function a(){D!==null&&D.removeEventListener("orientationchanged",m),F.pause(),F.src=null,x.removeEventListener("click",l),L.removeEventListener("click",f),window.removeEventListener("focus",o),[F,x,L].forEach(function(e){e&&document.body.removeChild(e)}),M&&(M.stopRecordAsync(),M=null)}function c(){var n,i,o=g().temporaryFolder;P==p.EncodingType.PNG?(i="photo.png",n=Windows.Media.MediaProperties.ImageEncodingProperties.createPng()):(i="photo.jpg",n=Windows.Media.MediaProperties.ImageEncodingProperties.createJpeg()),o.createFileAsync(i,h).then(function(e){return new WinJS.Promise(function(t){var i=new Windows.Storage.Streams.InMemoryRandomAccessStream,o=new Windows.Storage.Streams.InMemoryRandomAccessStream;M.capturePhotoToStreamAsync(n,i).then(function(){return Windows.Graphics.Imaging.BitmapDecoder.createAsync(i)}).then(function(e){return o.size=0,Windows.Graphics.Imaging.BitmapEncoder.createForTranscodingAsync(o,e)}).then(function(e){return e.bitmapTransform.rotation=w(D.getCurrentOrientation()),e.flushAsync()}).then(function(){return e.openAsync(Windows.Storage.FileAccessMode.readWrite)}).then(function(e){return Windows.Storage.Streams.RandomAccessStream.copyAndCloseAsync(o,e)}).done(function(){i.close(),o.close(),t(e)},function(){throw i.close(),o.close(),Error("An error has occured while capturing the photo.")})})}).done(function(n){a(),u(n,{destinationType:A,targetHeight:W,targetWidth:C,encodingType:P,saveToPhotoAlbum:b},e,t)},function(e){a(),t(e)})}function d(e){var t=e.videoDeviceController,n=t.getAvailableMediaStreamProperties(v.photo).map(function(e){return(e.width/e.height).toFixed(1)}).filter(function(e,t,n){return t===n.indexOf(e)}),i=t.getAvailableMediaStreamProperties(v.videoRecord).map(function(e){return(e.width/e.height).toFixed(1)}).filter(function(e,t,n){return t===n.indexOf(e)}),o=t.getAvailableMediaStreamProperties(v.videoPreview).map(function(e){return(e.width/e.height).toFixed(1)}).filter(function(e,t,n){return t===n.indexOf(e)}),r=[].concat(n,i,o),a=r.reduce(function(e,t){return e[t]||(e[t]=0),e[t]++,e},{});return Object.keys(a).filter(function(e){return a[e]===3})}function s(e,t){var n=e.videoDeviceController,i=n.getAvailableMediaStreamProperties(v.photo).filter(function(e){return(e.width/e.height).toFixed(1)===t}).reduce(function(e,t){return e.width*e.height>t.width*t.height?e:t}),o=n.getAvailableMediaStreamProperties(v.videoRecord).filter(function(e){return(e.width/e.height).toFixed(1)===t}).reduce(function(e,t){return e.width*e.height>t.width*t.height?e:t}),r=n.getAvailableMediaStreamProperties(v.videoPreview).filter(function(e){return(e.width/e.height).toFixed(1)===t}).reduce(function(e,t){return e.width*e.height>t.width*t.height?e:t});return n.setMediaStreamPropertiesAsync(v.photo,i).then(function(){return n.setMediaStreamPropertiesAsync(v.videoPreview,r)}).then(function(){return n.setMediaStreamPropertiesAsync(v.videoRecord,o)})}function l(){return this.getAttribute("clicked")==="1"?!1:(this.setAttribute("clicked","1"),c(),void 0)}function f(){return this.getAttribute("clicked")==="1"?!1:(this.setAttribute("clicked","1"),a(),t("no image selected"),void 0)}function m(e){y(e.orientation)}function w(e){switch(e){case Windows.Devices.Sensors.SimpleOrientation.notRotated:return Windows.Media.Capture.VideoRotation.clockwise90Degrees;case Windows.Devices.Sensors.SimpleOrientation.rotated90DegreesCounterclockwise:return Windows.Media.Capture.VideoRotation.none;case Windows.Devices.Sensors.SimpleOrientation.rotated180DegreesCounterclockwise:return Windows.Media.Capture.VideoRotation.clockwise90Degrees;case Windows.Devices.Sensors.SimpleOrientation.rotated270DegreesCounterclockwise:return Windows.Media.Capture.VideoRotation.clockwise180Degrees;default:return Windows.Media.Capture.VideoRotation.clockwise90Degrees}}function y(e){M.setPreviewRotation(w(e))}var A=n[1],C=n[3],W=n[4],P=n[5],b=n[9],E=n[11],F=null,x=null,L=null,M=null,I=null,k=Windows.Media.Capture,D=null;try{i(),r()}catch(R){t(R)}}function l(e,t,n){var i=n[1],o=n[3],r=n[4],a=n[5],c=!!n[7],d=n[9],s=Windows.Media.Capture,l=new s.CameraCaptureUI;l.photoSettings.allowCropping=c,l.photoSettings.format=a==p.EncodingType.PNG?s.CameraCaptureUIPhotoFormat.png:s.CameraCaptureUIPhotoFormat.jpeg;var g=null,f=s.CameraCaptureUIMaxPhotoResolution,h=o*r;g=o==-1&&r==-1?f.highestAvailable:h>307200?h>786432?h>3e6?h>5e6?f.highestAvailable:f.veryLarge5M:f.large3M:f.mediumXga:f.smallVga,l.photoSettings.maxResolution=g;var v,m=function(){window.removeEventListener("focus",m),u(v,{destinationType:i,targetHeight:r,targetWidth:o,encodingType:a,saveToPhotoAlbum:d},e,t)};0>navigator.appVersion.indexOf("Windows Phone 10.0")||window.addEventListener("focus",m),l.captureFileAsync(s.CameraCaptureUIMode.photo).done(function(n){return n?(v=n,0>navigator.appVersion.indexOf("Windows Phone 10.0")&&u(v,{destinationType:i,targetHeight:r,targetWidth:o,encodingType:a,saveToPhotoAlbum:d},e,t),void 0):(t("User didn't capture a photo."),window.removeEventListener("focus",m),void 0)},function(){t("Fail to capture a photo."),window.removeEventListener("focus",m)})}function u(e,t,n,r){var a=function(e){t.destinationType==p.DestinationType.FILE_URI||t.destinationType==p.DestinationType.NATIVE_URI?t.targetHeight>0&&t.targetWidth>0?i(n,r,e,t.targetWidth,t.targetHeight,t.encodingType):e.copyAsync(g().localFolder,e.name,h).done(function(e){n("ms-appdata:///local/"+e.name)},r):t.targetHeight>0&&t.targetWidth>0?o(n,r,e,t.targetWidth,t.targetHeight):w.readBufferAsync(e).done(function(t){var i=f(t);e.deleteAsync().done(function(){n(i)},function(e){r(e)})},r)};if(!t.saveToPhotoAlbum)return a(e),void 0;var c=new Windows.Storage.Pickers.FileSavePicker,d=function(t){t?(Windows.Storage.CachedFileManager.deferUpdates(t),e.moveAndReplaceAsync(t).then(function(){return Windows.Storage.CachedFileManager.completeUpdatesAsync(t)}).done(function(t){t===Windows.Storage.Provider.FileUpdateStatus.complete?a(e):r("File update status is not complete.")},r)):r("Failed to select a file.")};if(c.suggestedStartLocation=y.picturesLibrary,t.encodingType===p.EncodingType.PNG?(c.fileTypeChoices.insert("PNG",[".png"]),c.suggestedFileName="photo.png"):(c.fileTypeChoices.insert("JPEG",[".jpg"]),c.suggestedFileName="photo.jpg"),0>navigator.appVersion.indexOf("Windows Phone 8.1"))c.pickSaveFileAsync().done(d,r);else{var s=function(e){if(e.kind===Windows.ApplicationModel.Activation.ActivationKind.pickSaveFileContinuation){var t=e.file;d(t),m.removeEventListener("activated",s)}};m.addEventListener("activated",s),c.pickSaveFileAndContinue()}}var p=e("./Camera"),g=function(){return Windows.Storage.ApplicationData.current},f=function(e){return Windows.Security.Cryptography.CryptographicBuffer.encodeToBase64String(e)},h=Windows.Storage.CreationCollisionOption.generateUniqueName,v=Windows.Media.Capture.MediaStreamType,m=Windows.UI.WebUI.WebUIApplication,w=Windows.Storage.FileIO,y=Windows.Storage.Pickers.PickerLocationId;n.exports={takePicture:function(e,t,n){var i=n[2];i!=p.PictureSourceType.CAMERA?r(e,t,n):d(e,t,n)}};var A=[".avi",".flv",".asx",".asf",".mov",".mp4",".mpg",".rm",".srt",".swf",".wmv",".vob"],C=[".avi",".3gp",".3g2",".wmv",".3gp",".3g2",".mp4",".m4v"],S="1.8",T=2147483647;e("cordova/exec/proxy").add("Camera",n.exports)})