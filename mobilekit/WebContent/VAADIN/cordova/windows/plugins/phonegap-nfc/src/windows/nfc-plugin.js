cordova.define("phonegap-nfc.NfcPlugin",function(e,i,t){"use strict";var o="NFC_OK",s="NFC_DISABLED",n="NO_NFC_OR_NFC_DISABLED",r={toArray:function(e){for(var i=[],t=0;e.length>t;t+=1)i.push(e[t]);return i}},a={subscribedMessageId:-1,publishedMessageId:-1,proximityDeviceStatus:n,listeningForNonNdefTags:!1,tagEventTimeoutId:-1,initializeProximityDevice:function(){if(a.proximityDevice){try{a.proximityDevice.maxMessageBytes,a.proximityDeviceStatus=o}catch(e){console.log(e),a.proximityDeviceStatus=s}return a.proximityDeviceStatus===o}return a.proximityDevice=Windows.Networking.Proximity.ProximityDevice.getDefault(),a.proximityDevice?(a.proximityDevice.ondevicearrived=function(){console.log("NFC tag detected"),a.listeningForNonNdefTags&&(a.tagEventTimeoutId=setTimeout(a.fireTagEvent,100))},a.proximityDevice.ondevicedeparted=function(){console.log("NFC tag is gone")}):a.proximityDeviceStatus=n,a.proximityDeviceStatus===o},init:function(e){a.initializeProximityDevice(),a.proximityDevice||console.log("WARNING: proximity device is null"),e()},registerNdef:function(e,i){if(console.log("Listening for NFC tags with NDEF messages."),!a.initializeProximityDevice())return i(a.proximityDeviceStatus),void 0;try{a.subscribedMessageId=a.proximityDevice.subscribeForMessage("NDEF",a.messageReceivedHandler),e()}catch(t){console.log(t),i(t)}},removeNdef:function(e,i){if(console.log("Removing NDEF Listener"),!a.initializeProximityDevice())return i(a.proximityDeviceStatus),void 0;try{a.subscribedMessageId!==-1&&(a.proximityDevice.stopSubscribingForMessage(a.subscribedMessageId),a.subscribedMessageId=-1),e()}catch(t){console.log(t),i(t.message)}},addTagDiscoveredListener:function(e){a.listeningForNonNdefTags=!0,e()},remoteTagDiscoveredListener:function(e){a.listeningForNonNdefTags=!1,e()},writeTag:function(e,i,t){if(console.log("Write Tag"),!a.initializeProximityDevice())return i(a.proximityDeviceStatus),void 0;try{var o=t[0],s=ndef.encodeMessage(o);a.stopPublishing();var n=new Windows.Storage.Streams.DataWriter;n.unicodeEncoding=Windows.Storage.Streams.UnicodeEncoding.utf16LE,n.writeBytes(s),a.publishedMessageId=a.proximityDevice.publishBinaryMessage("NDEF:WriteTag",n.detachBuffer(),function(){console.log("Successfully wrote message to the NFC tag."),a.stopPublishing(),e()})}catch(r){console.log(r),i(r.message)}},shareTag:function(e,i,t){if(console.log("Share Tag"),!a.initializeProximityDevice())return i(a.proximityDeviceStatus),void 0;try{var o=t[0],s=ndef.encodeMessage(o);a.stopPublishing();var n=new Windows.Storage.Streams.DataWriter;n.unicodeEncoding=Windows.Storage.Streams.UnicodeEncoding.utf16LE,n.writeBytes(s),a.publishedMessageId=a.proximityDevice.publishBinaryMessage("NDEF",n.detachBuffer(),function(){console.log("Successfully shared message over peer-to-peer."),a.stopPublishing(),e()})}catch(r){console.log(r),i(r.message)}},unshareTag:function(e,i){if(console.log("Unshare Tag"),!a.initializeProximityDevice())return i(a.proximityDeviceStatus),void 0;try{a.stopPublishing(),e()}catch(t){console.log(t),i(t.message)}},enabled:function(e,i){a.initializeProximityDevice(),a.initializeProximityDevice()?e():i(a.proximityDeviceStatus)},showSettings:function(e,i){var t="ms-settings-proximity:",o=new Windows.Foundation.Uri(t);Windows.System.Launcher.launchUriAsync(o).then(function(t){t?e():i()})},stopPublishing:function(){a.publishedMessageId!==-1&&(a.proximityDevice.stopPublishingMessage(a.publishedMessageId),a.publishedMessageId=-1)},messageReceivedHandler:function(e,i){clearTimeout(a.tagEventTimeoutId);var t=new Uint8Array(i.data.length),o=Windows.Storage.Streams.DataReader.fromBuffer(i.data);o.readBytes(t),o.close();var s=r.toArray(t),n=ndef.decodeMessage(s);console.log(JSON.stringify(n));var c={ndefMessage:n},g=document.createEvent("Events");g.initEvent("ndef",!0,!1),g.tag=c,document.dispatchEvent(g)},fireTagEvent:function(){var e=document.createEvent("Events");e.initEvent("tag",!0,!1),e.tag={},document.dispatchEvent(e)}};t.exports={init:a.init,registerNdef:a.registerNdef,removeNdef:a.removeNdef,registerTag:a.addTagDiscoveredListener,remoteTag:a.removeTagDiscoveredListener,writeTag:a.writeTag,shareTag:a.shareTag,unshareTag:a.unshareTag,enabled:a.enabled,showSettings:a.showSettings},e("cordova/exec/proxy").add("NfcPlugin",t.exports)})