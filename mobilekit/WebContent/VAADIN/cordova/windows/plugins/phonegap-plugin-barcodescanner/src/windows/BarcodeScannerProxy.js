cordova.define("phonegap-plugin-barcodescanner.BarcodeScannerProxy",function(e,n,t){function r(){var e=Windows.Devices.Enumeration;return e.DeviceInformation.findAllAsync(e.DeviceClass.videoCapture).then(function(n){if(!n||n.length===0)throw Error("No cameras found");var t=n.filter(function(n){return n.enclosureLocation&&n.enclosureLocation.panel===e.Panel.back});return(t[0]||n[0]).id})}function i(e,n){var t;switch(e){case Windows.Graphics.Display.DisplayOrientations.landscape:t=0;break;case Windows.Graphics.Display.DisplayOrientations.portrait:t=n?270:90;break;case Windows.Graphics.Display.DisplayOrientations.landscapeFlipped:t=180;break;case Windows.Graphics.Display.DisplayOrientations.portraitFlipped:t=n?90:270;break;default:t=0}return t}function o(){this._promise=null,this._cancelled=!1}var a=e("cordova/urlutil"),c={1:"AZTEC",2:"CODABAR",4:"CODE_39",8:"CODE_93",16:"CODE_128",32:"DATA_MATRIX",64:"EAN_8",128:"EAN_13",256:"ITF",512:"MAXICODE",1024:"PDF_417",2048:"QR_CODE",4096:"RSS_14",8192:"RSS_EXPANDED",16384:"UPC_A",32768:"UPC_E",61918:"All_1D",65536:"UPC_EAN_EXTENSION",131072:"MSI",262144:"PLESSEY"};o.get=function(e){return e.getPreviewFrameAsync&&ZXing.BarcodeReader?new o:new WinRTBarcodeReader.Reader},o.prototype.init=function(e,n,t){this._capture=e,this._width=n,this._height=t,this._zxingReader=new ZXing.BarcodeReader},o.prototype.readCode=function(){function e(e,n,t,r){var i=Windows.Graphics.Imaging,o=Windows.Storage.Streams,a=new Windows.Media.VideoFrame(i.BitmapPixelFormat.bgra8,t,r);return e.getPreviewFrameAsync(a).then(function(e){var i=e.softwareBitmap,a=new o.Buffer(i.pixelWidth*i.pixelHeight*4);e.softwareBitmap.copyToBuffer(a),e.close();var c=new Uint8Array(a.length),s=o.DataReader.fromBuffer(a);return s.readBytes(c),s.close(),n.decode(c,t,r,ZXing.BitmapFormat.bgra32)})}var n=this;return e(this._capture,this._zxingReader,this._width,this._height).then(function(e){return n._cancelled?null:e||(n._promise=n.readCode())})},o.prototype.stop=function(){this._cancelled=!0},t.exports={scan:function(e,n){function t(e){if(g){var n="C380465D-2271-428C-9B83-ECEA3B4A85C1",t=e&&e.target||Windows.Graphics.Display.DisplayInformation.getForCurrentView(),r=t.currentOrientation;w=g.getPreviewMirroring();var o=i(r,w),a=g.videoDeviceController.getMediaStreamProperties(Windows.Media.Capture.MediaStreamType.videoPreview);return a.properties.insert(n,o),g.videoDeviceController.setMediaStreamPropertiesAsync(Windows.Media.Capture.MediaStreamType.videoPreview,a)}}function s(){var e=document.createElement("link");e.rel="stylesheet",e.type="text/css",e.href=a.makeAbsolute("/www/css/plugin-barcodeScanner.css"),document.head.appendChild(e),capturePreviewFrame=document.createElement("div"),capturePreviewFrame.className="barcode-scanner-wrap",f=document.createElement("video"),f.className="barcode-scanner-preview",f.addEventListener("click",function(){u()}),v=document.createElement("div"),v.className="barcode-scanner-mark",h=document.createElement("div"),h.className="barcode-scanner-app-bar",h.onclick=function(e){e.cancelBubble=!0},C=document.createElement("div"),C.innerText="close",C.className="app-bar-action action-close",h.appendChild(C),C.addEventListener("click",m,!1),document.addEventListener("backbutton",m,!1),[f,v,h].forEach(function(e){capturePreviewFrame.appendChild(e)})}function u(e){var n=WinJS.Promise.wrap();if(!f||f.paused)return n;if(!e)try{e=g&&g.videoDeviceController}catch(t){return console.log("Failed to access focus control for current camera: "+t),n}return e.focusControl&&e.focusControl.supported?e.focusControl.focusAsync():(console.log("Focus control for current camera is not supported"),n)}function d(e){function n(n){return e.supportedFocusModes.indexOf(n).returnValue}if(!e||!e.supported||!e.configure)return WinJS.Promise.wrap();var t=Windows.Media.Devices.FocusMode,r=new Windows.Media.Devices.FocusSettings;return r.autoFocusRange=Windows.Media.Devices.AutoFocusRange.normal,n(t.continuous)?(console.log("Device supports continuous focus mode"),r.mode=t.continuous):n(t.auto)&&(console.log("Device doesn't support continuous focus mode, switching to autofocus mode"),r.mode=t.auto),e.configure(r),WinJS.Promise.timeout(200).then(function(){return e.focusAsync()})}function p(){return r().then(function(e){var n=new Windows.Media.Capture.MediaCaptureInitializationSettings;return n.streamingCaptureMode=Windows.Media.Capture.StreamingCaptureMode.video,n.photoCaptureSource=Windows.Media.Capture.PhotoCaptureSource.videoPreview,n.videoDeviceId=e,g=new Windows.Media.Capture.MediaCapture,g.initializeAsync(n)}).then(function(){var e=g.videoDeviceController,n=e.getAvailableMediaStreamProperties(Windows.Media.Capture.MediaStreamType.videoRecord);n=Array.prototype.slice.call(n),n=n.filter(function(e){return e.subtype!=="Unknown"}).sort(function(e,n){return n.width-e.width});var t=n[0];return e.setMediaStreamPropertiesAsync(Windows.Media.Capture.MediaStreamType.videoRecord,t).then(function(){return{capture:g,width:t.width,height:t.height}})}).then(function(e){return f.msZoom=!0,f.src=URL.createObjectURL(g),f.play(),document.body.appendChild(capturePreviewFrame),d(e.capture.videoDeviceController.focusControl).then(function(){return Windows.Graphics.Display.DisplayInformation.getForCurrentView().addEventListener("orientationchanged",t,!1),t()}).then(function(){return e})})}function l(){Windows.Graphics.Display.DisplayInformation.getForCurrentView().removeEventListener("orientationchanged",t,!1),document.removeEventListener("backbutton",m),f.pause(),f.src=null,capturePreviewFrame&&document.body.removeChild(capturePreviewFrame),y&&y.stop(),y=null,g&&g.stopRecordAsync(),g=null}function m(){y&&y.stop()}var f,v,h,w,C,g,y;WinJS.Promise.wrap(s()).then(function(){return p()}).then(function(e){return y=o.get(e.capture),y.init(e.capture,e.width,e.height),WinJS.Promise.timeout(200).then(function(){return y.readCode()})}).done(function(n){l(),e({text:n&&n.text,format:n&&c[n.barcodeFormat],cancelled:!n})},function(e){l(),n(e)})},encode:function(e,n){n("Not implemented yet")}},e("cordova/exec/proxy").add("BarcodeScanner",t.exports)})